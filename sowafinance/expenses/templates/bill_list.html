{% load static humanize %}
{% include 'includes/navbar.html' %}
{% include 'includes/sidebar.html' %}

<style>
  .button{background:#39B54B;color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer}
  .button:hover{background:#2a8b3f}
  .filters{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .filters input,.filters select{padding:8px;border:1px solid #ddd;border-radius:6px}
  .content-table{width:100%;border-collapse:collapse;margin-top:14px}
  .content-table th,.content-table td{border:1px solid #eee;padding:10px;text-align:left}
  .content-table thead th{background:#fafafa}
  .status-chip{padding:3px 8px;border-radius:12px;font-size:12px;font-weight:600;display:inline-block}
  .status-open{background:#e8f7ee;color:#2e8b3f}
  .status-overdue{background:#ffecec;color:#c20}
  .dropdown{position:relative;display:inline-block}
  .dropbtn{background:#39B54B;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}
  .dropdown-content{display:none;position:absolute;right:0;background:#fff;border:1px solid #ddd;border-radius:6px;min-width:160px;box-shadow:0 2px 10px rgba(0,0,0,.08);z-index:10}
  .dropdown-content a{display:block;padding:10px 12px;color:#333;text-decoration:none}
  .dropdown-content a:hover{background:#f5f5f5}
  .dropdown:hover .dropdown-content{display:block}
  .totals-bar{margin-top:10px;display:flex;gap:20px;flex-wrap:wrap;color:#444}
  .totals-bar span b{color:#111}
  .pager{margin-top:14px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .pager a,.pager span{padding:6px 10px;border:1px solid #ddd;border-radius:6px;text-decoration:none;color:#333}
  .pager .current{background:#39B54B;color:#fff;border-color:#39B54B}
#mainbody{margin-top: 17%;}
</style>

<div class="action" style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
  <h1 style="margin-right:auto">BILLS</h1>

  <!-- Quick filters/search -->
  <form method="get" class="filters">
    <input type="text" name="q" value="{{ q }}" placeholder="Search bill no / supplier / location">
    <input type="date" name="from" value="{{ from }}">
    <input type="date" name="to" value="{{ to }}">
    <button class="button" type="submit">Filter</button>
    <a class="button" href="{% url 'expenses:bills-list' %}" style="text-decoration:none;background:#555">Reset</a>
  </form>

  <a class="button" href="{% url 'expenses:add-bill' %}" style="text-decoration:none">New Bill</a>
</div>

<div class="main_body" id="mainbody">
  <table class="content-table">
    <thead>
      <tr style="color: #39B54B;">
        
        <th>DATE</th>
        <th>TYPE</th>
        <th>NO.</th>
        <th>SUPPLIER</th>
        <th>LOCATION</th>
        <th>SUBTOTAL</th>
        <th>VAT</th>
        <th>TOTAL</th>
        <th>STATUS</th>
        <th>ACTIONS</th>
      </tr>
    </thead>
    <tbody>
      {% if page_obj.object_list %}
        {% for bill, status in page_obj.object_list %}
        <tr>
          
          <td>{{ bill.bill_date|date:"d/m/Y" }}</td>
          <td>Bill</td>
          <td>{{ bill.bill_no }}</td>
          <td>
  {% if bill.supplier %}
    {{ bill.supplier.company_name }}
  {% else %}
    {{ bill.mailing_address }}
  {% endif %}
</td>
          <td>{{ bill.location|default:"—" }}</td>
          <td>{{ bill.subtotal|default:0|floatformat:2|intcomma }}</td>
          <td>{{ bill.total_vat|default:0|floatformat:2|intcomma }}</td>
          <td>{{ bill.total_amount|default:0|floatformat:2|intcomma }}</td>
          <td>
            {% if status == "Overdue" %}
              <span class="status-chip status-overdue">Overdue</span>
            {% else %}
              <span class="status-chip status-open">Open</span>
            {% endif %}
          </td>
          <td>
            <div class="dropdown">
              <button class="dropbtn">Actions <i class='bx bx-chevron-down'></i></button>
              <div class="dropdown-content">
                <a href="{% url 'expenses:bill-detail' bill.id %}">View</a>
                <a href="{% url 'expenses:bill-edit' bill.id %}">Edit</a>
                <!-- Add more like Print/Download later -->
              </div>
            </div>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="11" style="text-align:center;color:#777">No bills found.</td></tr>
      {% endif %}
    </tbody>
  </table>

  <!-- Totals for current filter -->
  <div class="totals-bar">
    <span>Total bills: <b>{{ count_all }}</b></span>
    <span>Subtotal: <b>{{ totals.subtotal|default:0|floatformat:2|intcomma }}</b></span>
    <span>VAT: <b>{{ totals.tax|default:0|floatformat:2|intcomma }}</b></span>
    <span>Grand Total: <b>{{ totals.grand|default:0|floatformat:2|intcomma }}</b></span>
  </div>

  <!-- Pagination -->
  {% if page_obj.paginator.num_pages > 1 %}
  <div class="pager">
    {% if page_obj.has_previous %}
      <a href="?{% if q %}q={{ q|urlencode }}&{% endif %}{% if from %}from={{ from }}&{% endif %}{% if to %}to={{ to }}&{% endif %}page={{ page_obj.previous_page_number }}">« Prev</a>
    {% endif %}
    <span class="current">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?{% if q %}q={{ q|urlencode }}&{% endif %}{% if from %}from={{ from }}&{% endif %}{% if to %}to={{ to }}&{% endif %}page={{ page_obj.next_page_number }}">Next »</a>
    {% endif %}
  </div>
  {% endif %}
</div>

{% include 'includes/footer.html' %}
