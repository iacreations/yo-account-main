{% load static humanize %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Receipt #{{ receipt.id|stringformat:"04d" }}</title>
  <style>
    :root{--brand:#39B54B;--ink:#0f5132;--muted:#667085;--line:#e7e7e7}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
         background:#f6f8f7;color:#111;margin:0;padding:24px}
    .sheet{max-width:820px;margin:0 auto;background:#fff;border:1px solid var(--line);
           border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.06);padding:28px}
    .topbar{display:flex;justify-content:space-between;align-items:flex-start;gap:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:56px;width:auto}
    .brand h1{margin:0;font-size:22px;color:var(--brand);letter-spacing:.3px}
    .meta{text-align:right;font-size:14px}
    .meta .big{font-size:13px;font-weight:800;color:#0f172a}
    .muted{color:var(--muted)}
    .bar{height:4px;background:var(--brand);margin:16px 0 20px;border-radius:3px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}
    .card{border:1px solid var(--line);border-radius:10px;padding:12px}
    .card h4{margin:0 0 6px;color:var(--ink);letter-spacing:.2px}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
    table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);
          border-radius:10px;overflow:hidden;margin-top:8px}
    thead th{background:linear-gradient(0deg,#e6f7ea,#f5fff8);color:var(--ink);
             font-weight:800;letter-spacing:.2px;text-align:left;padding:10px 12px;border-bottom:1px solid var(--line)}
    tbody td{padding:10px 12px;border-bottom:1px solid #f1f1f1;vertical-align:top}
    .num{text-align:right;white-space:nowrap}
    .totals{display:grid;grid-template-columns:1fr 260px;gap:16px;margin-top:16px}
    .summary{border:1px solid var(--line);border-radius:10px;padding:12px}
    .pair{display:flex;justify-content:space-between;margin:6px 0}
    .pair .lbl{color:#334155}
    .pair strong{font-weight:800}
    .grand{border-top:2px dashed #dfe7e3;margin-top:6px;padding-top:8px}
    .paid{color:#065f46;font-weight:800}
    .balance{color:#111;font-weight:900}
    .footer{margin-top:28px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px}
    .btns{display:flex;gap:10px}
    .btn{background:var(--brand);color:#fff;border:0;border-radius:8px;padding:8px 12px;
         font-weight:800;text-decoration:none;cursor:pointer}
    .btn.out{background:#eefaf0;color:#0f5132;border:1px solid #cceedd}
    @media print{
      body{background:#fff;padding:0}
      .sheet{box-shadow:none;border:none;border-radius:0;max-width:none}
      .btns{display:none}
    }
  </style>
</head>
<body>
  <div class="sheet">
    <div class="topbar">
      <div class="brand">
        <img
  src="{% if org and org.logo_url %}{{ org.logo_url }}{% elif logo_url %}{{ logo_url }}{% else %}{% static 'sowaf/images/yo-logo.png' %}{% endif %}"
  alt="logo"
  style="height:42px;width:auto;">
        <div>
          <h1>{{ company_name|default:"YoAccountant" }}</h1>
          <div class="muted" style="font-size:13px;">
            {{ company_address|default:"Your Address" }} •
            {{ company_phone|default:"+000 000 000" }} •
            {{ company_email|default:"info@example.com" }}
          </div>
        </div>
      </div>
      <div class="meta">
        <div class="big">RECEIPT</div>
        <div>#{{ receipt.id|stringformat:"04d" }}</div>
        <div class="muted">Date: <span class="mono">{{ receipt.receipt_date|date:"M j, Y" }}</span></div>
        <div class="muted">Ref: <span class="mono">{{ receipt.reference_no|default:"—" }}</span></div>
      </div>
    </div>

    <div class="bar"></div>

    <div class="grid">
      <div class="card">
        <h4>Bill To</h4>
        <div style="white-space:pre-line">{{ receipt.customer.customer_name }}{% if receipt.customer.billing_address %}
{{ receipt.customer.billing_address }}{% endif %}</div>
      </div>
      <div class="card">
        <h4>Receipt Details</h4>
        <div class="muted">Deposit To</div>
        <div><strong>{{ receipt.deposit_to.account_name }}</strong></div>
        <div class="muted" style="margin-top:6px;">Payment Method</div>
        <div><strong class="mono">{{ receipt.payment_method|title }}</strong></div>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th style="width:44px;">#</th>
          <th>Product/Service</th>
          <th>Description</th>
          <th class="num">Qty</th>
          <th class="num">Rate</th>
          <th class="num">Line Total</th>
        </tr>
      </thead>
      <tbody>
        {% for ln in lines %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ ln.product.name|default:"—" }}</td>
          <td>{{ ln.description|default:"" }}</td>
          <td class="num">{{ ln.qty|floatformat:2 }}</td>
          <td class="num">{{ ln.unit_price|floatformat:2|intcomma }}</td>
          <td class="num">{{ ln.amount|floatformat:2|intcomma }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="6" class="muted">No line items.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="totals">
      <div>
        {% if receipt.memo %}
        <div class="card" style="min-height:72px">
          <h4>Memo</h4>
          <div class="muted" style="white-space:pre-line">{{ receipt.memo }}</div>
        </div>
        {% endif %}
      </div>
      <div class="summary">
        <div class="pair"><span class="lbl">Subtotal</span><span class="mono">{{ receipt.subtotal|floatformat:2|intcomma }}</span></div>
        <div class="pair"><span class="lbl">Discount</span><span class="mono">-{{ receipt.total_discount|floatformat:2|intcomma }}</span></div>
        <div class="pair"><span class="lbl">VAT</span><span class="mono">{{ receipt.total_vat|floatformat:2|intcomma }}</span></div>
        <div class="pair"><span class="lbl">Shipping</span><span class="mono">{{ receipt.shipping_fee|floatformat:2|intcomma }}</span></div>
        <div class="pair grand"><span class="lbl"><strong>Total</strong></span><span class="mono"><strong>{{ receipt.total_amount|floatformat:2|intcomma }}</strong></span></div>
        <div class="pair"><span class="lbl paid">Amount Paid</span><span class="mono paid">{{ receipt.amount_paid|default:0|floatformat:2|intcomma }}</span></div>
        <div class="pair"><span class="lbl balance">Balance</span><span class="mono balance">{{ receipt.balance|default:0|floatformat:2|intcomma }}</span></div>
      </div>
    </div>

    <div class="footer">
      <div>Thank you for your business.</div>
      <div class="btns">
        <a class="btn out" href="{% url 'sales:receipt-edit' receipt.id %}">Edit</a>
        <button class="btn" onclick="window.print()">Print</button>
      </div>
    </div>
  </div>
</body>
</html>
